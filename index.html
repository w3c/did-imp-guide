<!DOCTYPE html>
<html>

<head>
  <title>DID Implementation Guide v1.0</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     -->
  <script class="remove" src="https://www.w3.org/Tools/respec/respec-w3c"></script>
  <script class="remove" src="https://unpkg.com/reqlist/lib/reqlist.js"></script>

  <script type="text/javascript" class="remove">
    var respecConfig = {
      // specification status (e.g., WD, LCWD, NOTE, etc.). If in doubt use ED.
      specStatus: "unofficial",

      // the specification's short name, as in http://www.w3.org/TR/short-name/
      shortName: "did-imp-guide",
      xref: ["did-core"],

      // subtitle for the spec
      subtitle:
        "A DID developer's guide to understanding and implementing Decentralized Identifiers",

      // if you wish the publication date to be other than today, set this
      //publishDate: "2019-03-26",
      //crEnd: "2019-04-23",
      //implementationReportURI: "https://w3c.github.io/",
      previousMaturity: "UNOFFICIAL",
      previousPublishDate: "2021-01-27",

      // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
      // and its maturity status
      // previousPublishDate:  "1977-03-15",
      // previousMaturity:  "WD",

      // extend the bibliography entries
      localBiblio: {},
      doJsonLd: true,

      github: "https://github.com/w3c/did-imp-guide",
      includePermalinks: false,

      // if there a publicly available Editor's Draft, this is the link
      edDraftURI: "https://w3c.github.io/did-imp-guide/",

      // if this is a LCWD, uncomment and set the end of its review period
      // lcEnd: "2009-08-05",

      // editors, add as many as you like
      // only "name" is required
      editors: [
        {
          name: "Orie Steele",
          url: "https://www.linkedin.com/in/or13b/",
          company: "Transmute",
          companyURL: "https://www.transmute.industries/",
          w3cid: 109171,
        },
        {
          name: "Michael Prorock",
          url: "https://www.linkedin.com/in/mprorock/",
          company: "mesur.io",
          companyURL: "https://mesur.io/",
        },
      ],
      // authors, add as many as you like.
      // This is optional, uncomment if you have authors as well as editors.
      // only "name" is required. Same format as editors.
      authors: [
        {
          name: "Guillaume Dardelet",
          company: "Transmute",
          companyURL: "https://www.transmute.industries/",
        },
      ],
      // name of the WG
      group: "credentials",

      // name (with the @w3c.org) of the public mailing to which comments are due
      wgPublicList: "public-credentials",

      // URI of the patent status for this WG, for Rec-track documents
      // !!!! IMPORTANT !!!!
      // This is important for Rec-track documents, do not copy a patent URI from a random
      // document unless you know what you're doing. If in doubt ask your friendly neighborhood
      // Team Contact.
      //wgPatentURI:  "https://www.w3.org/2004/01/pp-impl/98922/status",
      maxTocLevel: 2,
      inlineCSS: true,
    };
  </script>
  <style>
    pre .highlight {
      font-weight: bold;
      color: green;
    }

    pre .comment {
      font-weight: bold;
      color: Gray;
    }

    .color-text {
      font-weight: bold;
      text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
    }

    .simple {
      width: 100%;
    }
  </style>
</head>

<body>
  <section id="abstract">
    <p>
      This document provides guidance to DID Method developers, related to
      serialization, cryptographic primitive selection, governance, and
      interoperability.
    </p>
    <p>
      Guidance provided in this document does not reflect the consenus of the W3C
      DID WG, although some members of the WG have contributed to it.
    </p>
  </section>

  <section id="sotd"></section>

  <section class="informative">
    <h2>Terminology</h2>
    <div data-include="https://w3c.github.io/did-core/terms.html"></div>
  </section>

  <section class="informative">
    <h2>Methods</h2>

    <p class="note">
      See [[DID-CORE]] for normative requirements associated with developing
      <a href="https://www.w3.org/TR/did-core/#methods">DID Methods</a>.
    </p>

    <p>
      Avoid introducing requirements in your DID method specification that are
      neither described in [[DID-CORE]] nor registered in the
      [[DID-SPEC-REGISTRIES]].
    </p>

    <p>
      Avoid constructing a new DID Method that is nearly identical to an existing
      DID Method.
    </p>

    <p>
      There are several "families" of DID Methods, including
      <a href="https://hyperledger-indy.readthedocs.io/en/latest/index.html">Hyperledger Indy</a>, <a
        href="https://identity.foundation/sidetree/spec/">Sidetree</a>, and
      various methods that share similar smart contracts or rely on shared
      content addressing technology.
    </p>

    <p class="advisement">
      Implementers are cautioned to write and regularly run integration and
      interoperability tests that span these "families", in order to ensure
      methods have sufficient support for open standards and real
      interoperability.
    </p>

    <p>
      The primary user-facing aspects of a DID Method are its
      <a href="#did-syntax">DID Syntax</a> and its
      <a href="#verifiable-data-registry">Verifiable Data Registry</a>.
      Together these determine most of the unique properties of a DID Method,
      and its privacy and security properties for comparison to other methods.
    </p>

    <section class="informative">
      <h3>DID Syntax</h3>
      <p class="note">
        See [[DID-CORE]] for normative requirements associated with developing
        <a href="https://www.w3.org/TR/did-core/#did-syntax">DID Syntax</a>.
      </p>
      <p>
        Avoid allowing users to control the structure of the DID Unique
        Suffix, also referred to as the <code>id-char</code> in the ABNF. This
        can be accomplished by coupling the create operation canonical
        representation to the <code>id-char</code>. It can also be
        accomplished by leveraging sources of entropy.
      </p>

      <p>
        Avoid vanity DIDs such as, for example,
        <code>did:example:deadbeef1f236...</code>. The structure of the
        identifier should not be relied on for anything other than collision
        resistance. Be especially careful of trusting a relationship between a
        DID subject and DID controller without relying on a cryptographically
        secure verification relationship for
        <a href="authentication">authentication</a>.
        Anyone can claim a DID, but only someone who controls the associated
        keys can authenticate their association with the DID.
        For example `did:example:xyzcorp` should not be assumed to belong to
        XYZ Corp.
      </p>

      <p>
        Depending on the nature of the
        <a href="#verifiable-data-registry">VDR</a>, publishing
        <code>type</code> or <code>kind</code> might be advantageous for
        decentralized discovery or mass surveillance. Implementers are not to
        rely on conformance to specification text while implementing
        decentralized identifiers.
      </p>
    </section>

    <section class="informative">
      <h2>Verifiable Data Registry</h2>

      <p class="note">
        See [[DID-CORE]] for normative requirements associated with developing
        <a href="https://www.w3.org/TR/did-core/#dfn-verifiable-data-registry">Verifiable Data Registry</a>.
      </p>

      <p>
        The <a href="#verifiable-data-registry">VDR</a> is the system to which
        DID Operations such as Create, Resolve, Update, and Deactivate are
        applied.
      </p>

      <p>
        Typically a globally-unique, tamper-evident, immutable log is used to
        produce a verifiable data registry.
      </p>

      <p>
        Blockchains or distributed ledgers are popular choices for building
        verifiable data registries, but there are other solutions which yield
        unique security pros and cons.
      </p>

      <p>
        Some DID methods rely on centralized trusted service providers and
        Merkle proofs to provide tamper-evident logs without the costs
        associated with distributeted consensus.
      </p>

      <p>
        Some DID methods rely on multiple registries that may not be globally
        available.
      </p>

      <p>
        Some DID methods might rely on legacy security infrastructure, such as
        TLS or TOR.
      </p>

      <p>
        Few DID methods support portability accross verifiable data
        registries, and altering the VDR associated with a DID will almost
        certainly impact Privacy and Security considerations.
      </p>

      <p>
        Intead of designing complex DID Methods with registry portability,
        consider supporting multiple DID methods that have each been designed
        to support disjoint security and/or privacy consideration, such as
        global discoverability, offline functionality, pairwise uniqueness, 
        linkage to existing roots of trust such as websites, etc.
      </p>

      <p>
        Depending on the nature of the VDR, it may be desirable to store data
        other than DID Documents, such as verifiable credentials,
        templates or schemas for credentials, discovery metadata, or integrity-
        or content-addressable identifiers for related information.
      </p>
    </section>

    <section class="informative">
      <h2>Establishing a DID</h2>

      <p>
        In order to create secure DID systems, it is important to consider the process
        of establishing a Decentralized Identifier.
      </p>


      <p class="advisement">
        Establishing cryptographic assurances for the identifier from its
        inception is critical to ensuring that the security of the system isn't
        compromised through attacks against the creation process.
      </p>

      <p>A commonly observed process for establishing a decentralized identifier is:</p>
      <ol>
        <li>
          Obtain <code>entropy</code> from a source of randomness that is as close to actually random as possible.
        </li>
        <li>Generate a first verification method from <code>entropy</code>.</li>
        <li>Use the first verification method to perform a DID Create Operation.</li>
      </ol>
      <p class="note">
        The Create Operation will often use the first verification directly, or a deterministic 
        function thereof, such as a hash, to construct and register the DID.
      </p>
      <p class="note">
        True randomness is <b>hard</b> to get. Sources such as the
        <a href="https://csrc.nist.gov/projects/interoperable-randomness-beacons">NIST Randomness Beacon</a>
        are reliable, but should not be used directly as a secret key.
      </p>
</section>

    

  <section class="informative">
    <h2>DID Resolution</h2>

    <p class="note">
      See [[DID-CORE]] for normative requirements associated with developing
      <a href="https://www.w3.org/TR/did-core/#did-resolution">DID Resolution</a>.
    </p>

    <p>
      DID resolution is a function which takes a DID, and produces a DID
      Resolution response in a representation, most commonly JSON.
    </p>

   

    <p>
      DID resolution can be proxied through intermediaries such as command
      line tools or http servers. Because the DID Document contains key
      material, such intermediaries represent excellent targets for attackers,
      who can use the intermediaries to tamper with verification relationships.
    </p>

    <p>
      Avoid tampering with a DID Document that as been returned by DID Method
      software. It is better to throw an error than to attempt to solve problems
      in the underlying DID Method.
    </p>

    <p>
      Avoid transforming DID Documents without the consent of the DID subject
      or controller.
    </p>

    <p>
      Whenever possible, run all software necessary to support a DID Method
      yourself.
    </p>

    <section class="informative">
      <h3>DID URL Syntax</h3>

      <p class="note">
        See [[DID-CORE]] for normative requirements associated with developing
        <a href="https://www.w3.org/TR/did-core/#did-url-syntax">DID URL Syntax</a>.
      </p>

      <p>
        DID URLs can be used to identify sub-resources inside a DID Document,
        older versions of a DID Document, or resources outside of a DID
        Document.
      </p>

      <pre class="example" title="DID URL identifying a verification method in a DID Document">
        did:example:123#primary
        </pre>

      <pre class="example" title="DID URL identifying a service in a DID Document">
          did:example:123#agent
          </pre>

      <pre class="example" title="DID URL identifying a resource outside a DID Document">
          did:example:123?service=packages@relativeRef=/jose/versions/v0.1.2/archive.zip
          </pre>

      <p>
        Adjusting any part of a DID URL, including the <code>did</code>,
        <code>path</code>, or <code>query</code>, changes the identifier.
      </p>

      <p>
        The resource identifiers <code>did:example:123</code>,
        <code>did:example:123/path</code> and
        <code>did:example:123?args=1</code> each identify a unique resource.
      </p>

      <section class="informative">
        <h4>Path</h4>

        <p class="note">
          See [[DID-CORE]] for normative requirements associated with
          developing
          <a href="https://www.w3.org/TR/did-core/#path">Path</a>.
        </p>
        <p>
          Avoid using <code>path</code>; as of this writing, there are not enough 
          implementations that make use of it.
        </p>

        <pre class="example" title="DID URL identifying a resource outside a DID Document">
          did:example:123/ephemeral/77d66171-b290-489c-abf1-95ae10725201#primary
          </pre>
      </section>

      <section class="informative">
        <h4>Query</h4>

        <p class="note">
          See [[DID-CORE]] for normative requirements associated with
          developing
          <a href="https://www.w3.org/TR/did-core/#query">Query</a>.
        </p>

        <p>
          Avoid using <code>query</code>; as of this writing, there are not enough 
          implementations that make use of it.
        </p>

        <pre class="example" title="DID URL identifying a verification method in an older version of a DID Document">
          did:example:123?version-id=77d66171-b290-489c-abf1-95ae10725201#primary
        </pre>
      </section>

      <section class="informative">
        <h4>Fragment</h4>

        <p class="note">
          See [[DID-CORE]] for normative requirements associated with
          developing
          <a href="https://www.w3.org/TR/did-core/#fragment">Fragment</a>.
        </p>

        <pre class="example" title="DID URL identifying a verification method in a DID Document">
          did:example:123#primary
        </pre>

        <p>
          Fragments identify sub-resources of a resource identified with a DID
          URL.
        </p>

        <p>
          The interpretation of the fragment is determined by the Media Type 
          (formerly known as a MIME type).
        </p>
      </section>
    </section>

    <section class="informative">
      <h3>Representations</h3>

      <p class="note">
        See [[DID-CORE]] for normative requirements associated with developing
        <a href="https://www.w3.org/TR/did-core/#representations">Representations</a>.
      </p>

      <p>
        The [[DID-CORE]] specification describes representations and the
        [[DID-SPEC-REGISTRIES]] supports the registration of an unbounded
        number of alternative representations.
      </p>

      <p>Each representation has unique pros and cons.</p>

      <p>
        DID Methods are responsible for producing a DID Document in the
        requested representation.
      </p>

      <p>
        DID Method implementers may choose to return verification methods in
        alternate formats for representations, for example, an implementer
        might prefer to return verification material encoded with
        <code>publicKeyJwk</code> for <code>application/did+json</code> and
        <code>publicKeyBase58</code> for <code>application/did+ld+json</code>.
      </p>


      <p class="issue">
        This sentence above is contested, see <a href="https://github.com/w3c/did-imp-guide/issues/5">
        this conversation</a>.
      </p>

      <p>
        Avoid allowing arbitrary unknown properties such as <code>__proto__</code>
        or other characters that might be used to attack JSON parsing into 
        <code>application/did+json</code> .
      </p>

      <p>
        While <code>application/did+json</code> is very flexible and allows
        for arbitrary JSON, implementers are cautioned to implement security
        in depth.
      </p>

      <p>
        Implementers are cautioned to review
        <a href="https://owasp.org/www-project-top-ten/">OWASP Top 10</a>
      </p>

      <p>
        Implementers should confirm that each representation they decide to
        support is interoperable with the same representation in other DID
        Methods.
      </p>

      <p>
        Implementers should avoid guessing about conformance to [[DID-CORE]].
      </p>

      <section class="informative">
        <h3>DID URL Dereferencing</h3>
        <p class="note">
          See [[DID-CORE]] for normative requirements associated with
          developing
          <a href="https://www.w3.org/TR/did-core/#did-url-dereferencing">DID URL Dereferencing</a>.
        </p>

        <p>
          Dereferencing is critical to integrating with cryptographic toolkits
          such as Linked Data Proofs, JOSE, PGP, or Anon Creds.
        </p>
      </section>

      <section class="informative">
        <h3>application/did+json</h3>
      </section>

      <section class="informative">
        <h3>application/did+ld+json</h3>
      </section>
    </section>
  </section>

  <section class="informative">
    <h2>Verification Relationships</h2>
    <p class="note">
      See [[DID-CORE]] for normative requirements associated with developing
      <a href="https://www.w3.org/TR/did-core/#verification-relationships">Verification Relationships</a>.
    </p>

    <p>
      Verification relationships are loosely equivalent to the concept of key
      purpose.
    </p>

    <p>
      It is considered a security best practice not to reuse the same key for
      multiple purposes.
    </p>

    <section class="informative">
      <h2>Authentication</h2>
      <p class="note">
        See [[DID-CORE]] for normative requirements associated with developing
        <a href="https://www.w3.org/TR/did-core/#authentication">Authentication</a>.
      </p>
      <p>
        Implementers are advised to implement support for this relationship.
      </p>
      <p>
        This relationship should be used for proofs or signatures associated
        with DID Subject authentication.
      </p>

      <p>Avoid conflating authentication and authorization.</p>

      <p>
        Avoid leveraging alternative relationships for the purpose of
        authentication.
      </p>
    </section>

    <section class="informative">
      <h2>Assertion Method</h2>
      <p class="note">
        See [[DID-CORE]] for normative requirements associated with developing
        <a href="https://www.w3.org/TR/did-core/#assertion">Assertion</a>.
      </p>
      <p>
        Implementers are advised to implement support for this relationship.
      </p>
      <p>
        This relationship should be used for proofs or signatures associated
        with claims issued by this DID Subject about another identifier, which
        might be a DID.
      </p>

      <p>
        This method is described in the [[VC-DATA-MODEL], see
        <a href="https://www.w3.org/TR/vc-data-model/#proofs-signatures-0">Proofs</a>
      </p>

      <p>
        Avoid leveraging alternative relationships for the purpose of issuing
        credentials.
      </p>
    </section>
  </section>

  </section>

  <section class="informative">
    <h2>Data Model and Representations</h2>

    <p class="note">
      See [[DID-CORE]] for normative requirements associated with the
      <a href="https://www.w3.org/TR/did-core/#data-model">Data Model</a>.
    </p>

    <p class="note">
      See [[DID-CORE]] for normative requirements associated with
      <a href="https://www.w3.org/TR/did-core/#representations">Representations</a>.
    </p>

    <p class="advisement">
      There is no consensus regarding preserving data model properties accross representations.
      Removing properties when converting a did document can result in an inability to maintain 
      interoperability with [[VC-DATA-MODEL]].
    </p>

    <section>
      <h2>Approach 1</h2>

    <p>
      The DID document data model contains “properties” (such as `id`, `verificationMethod`, and `service`), which are
      defined in a way that is independent of a concrete representation. There are a number of known representations,
      including JSON and JSON-LD (defined by DID Core), and CBOR (defined by a DID WG Note). Additional representations
      (such as XML, YAML, CBOR-LD, and others) are possible and may be defined in the future. For each of these
      representations, a combination of production and consumption rules defines the concrete syntax of properties, but
      the semantics of properties are independent of any given representation. In other words, in every representation
      of a DID document, there is always a way to represent a `service` or a `verificationMethod`, and their meanings
      are consistent across conformant representations.
    </p>

    <p>
      In addition to “properties”, a DID document may contain “representation-specific entries” which may be
      required by certain representations in order to fully represent the DID document data model and its
      properties. For example, the JSON-LD representation of a DID document (with media type `application/did+ld+json`) requires the
      `@context` representation-specific entry, in order to correctly express the semantics of properties such as `id`,
      `verificationMethod` or `service` within the JSON-LD representation. This enables JSON-LD’s semantics which are
      based on a decentralized, permissionless, open-world data model.
    </p>

    <p>
      In contrast to this, the (non-LD) JSON representation (with media type `application/did+json`) does not have this semantic
      capability; instead, (non-LD) JSON documents always need agreement on semantics in some out-of-band way that is
      not part of the document itself. In the case of DID documents using the (non-LD) JSON representation, those semantics are
      typically established by the <a href="https://w3c.github.io/did-spec-registries/">DID Spec Registries</a>. Therefore,
      establishing semantics of DID document properties in the (non-LD) JSON representation does not require
      the representation-specific `@context` entry, as is required by the JSON-LD representation.
    </p>

    <p>
      Similar holds true for the (non-LD) CBOR representation.
    </p>

    <p>
      Other examples of “representation-specific entries” could be XML namespace definitions or YAML tags, although
      these particular representations have not been defined at the time of this writing.
    </p>

    <p>
      If an entry that is specific to one representation appears in another representation, it can be called a
      "representation-foreign entry". An example of this is an `@context` entry appearing in the `application/did+json`
      representation.
    </p>

    <p>
      Examples of “representation-specific entries” and “representation-foreign entries”:
    </p>

    <figure id="representation-entries">
      <img style="margin: auto; display: block;"
           src="diagrams/representation-specific-and-foreign-entries.png" alt="
Examples of representation-specific and representation-foreign entries in various representations.">
      <figcaption>
        Representation-specific and representation-foreign entries.
      </figcaption>
    </figure>

    <section class="informative">
      <h3>
        Avoid representation-foreign entries
      </h3>

      <p class="advisement">
        It is bad practice and potentially harmful for producers to include "representation-foreign entries" in DID
        documents.
      </p>

      <p>
        Different implementations of DID document consumers may or may not be able to properly understand the meaning
        and processing rules of representation-foreign entries. Since DIDs and DID documents form an open ecosystem with
        many producers and consumers, a producer cannot anticipate the behavior of a consumer with regard to
        representation-foreign entries.
      </p>

      <p>
        For example, if a producer adds an `@context` entry to a DID document in the `application/did+json`
        representation, some consumers (those that understand JSON-LD, such as JSON-LD document loaders) may process it
        in one way, while other consumers (those that only understand plain JSON, without any JSON-LD specific rules)
        may process it in a different way.
      </p>

      <p>
        This can lead to inconsistent behavior by consumers that cannot be predicted by a producer.
      </p>

    </section>

    <section class="informative">
      <h3>
        Reliance on representation-foreign entries
      </h3>

      <p class="advisement">
        It is bad practice and potentially harmful for consumers to rely on "representation-foreign entries" in DID
        documents.
      </p>

      <p>
        As a special case of the previous section, certain consumers may go as far as relying on the presence of
        representation-foreign entries. For example, an incorrectly implemented consumer of DID documents in the
        `application/did+json` representation may attempt to apply JSON-LD tooling to that representation. That tooling
        is dependent on the presence of the `@context` representation-foreign entry, which is not actually required (and
        in fact discouraged) to be used in the `application/did+json` representation.
      </p>

      <p>
        The result is lack of interoperability, since such consumers will throw errors even if the returned DID document
        representation is actually conformant.
      </p>

    </section>

    <section class="informative">
      <h3>
        Security problems with representation-foreign entries
      </h3>

      <p>
        If some implementations of DID document consumers process representation-foreign entries, and others don’t, then
        this can lead to security holes, since the semantics of DID document properties will not be interpreted in a
        predictable way.
      </p>

      <p>
        For example, consider the following DID document, and assume that the JSON-LD context
        `https://myextensions.com/other-definitions.jsonld` defines `blockchainAccountId` in a way that is different
        from the <a href="https://w3c.github.io/did-spec-registries/#blockchainaccountid">property listed in the DID
        Specification Registries</a>.
      </p>

      <pre class="example nohighlight" title="A DID document in the `application/did+json` representation with the `@context` representation-foreign entry">
{
  "@context":[
    "https://www.w3.org/ns/did/v1",
    "https://myextensions.com/other-definitions.jsonld"
  ],
  "id":"did:example:123456789abcdefghi",
  "verificationMethod":[{
    "id": "did:example:123456789abcdefghi#vm-3",
    "controller": "did:example:123456789abcdefghi",
    "type": "EcdsaSecp256k1RecoveryMethod2020",
    "blockchainAccountId": "0xF3beAC30C498D9E26865F34fCAa57dBB935b0D74"
  }]
}
      </pre>

      <p>
        If this DID document is consumed as `application/did+json` by an implementation that doesn't understand JSON-LD,
        it will interpret `blockchainAccountId` as the <a
              href="https://w3c.github.io/did-spec-registries/#blockchainaccountid">property listed in the DID
        Specification Registries</a>, and it will process it accordingly.
      </p>

      <p>
        If the exact same DID document is consumed as `application/did+json` by an implementation that understands
        JSON-LD, it may interpret `blockchainAccountId` using the provided JSON-LD context, and therefore process it
        differently.
      </p>

      <p>
        It is a common mistake to claim that "JSON-LD is just JSON", and to justify injecting the `@context`
        representation-foreign entry into a DID document in the `application/did+json` representation. This claim
        however is true only on the syntax level, but wrong and dangerous on the semantic level, especially when
        security-related properties are involved. In the example above, different consumer implementations are likely to
        come to different conclusions on how the DID can be controlled.
      </p>

      <p class="advisement">
        Representation-foreign entries in DID documents should be avoided, since they can lead to inconsistent and
        unpredictable DID control decisions.
      </p>

    </section>

    <section class="informative">
      <h3>
        Conversion between Representations
      </h3>

      <p>
        The DID document data model and the production/consumption rules of representations have been designed to enable
        lossless conversion between representations. Conversion between representations is achieved by executing the
        consumption rules of the source representation, and then the production rules of the target representation.
      </p>

      <p>
        The <a href="https://w3c.github.io/did-spec-registries/">DID Specification Registries</a> provide additional
        information about properties as well as representation-specific entries that help with such conversion. For
        example, a DID document in the `application/did+json` representation can be converted to the
        `application/did+ld+json` representation by adding a `@context` representation-specific entry during production,
        using the JSON-LD context information in the DID <a href="https://w3c.github.io/did-spec-registries/">Specification
        Registries</a>.
      </p>

      <p>
        Conversely, a DID document in the `application/did+ld+json` representation can be converted to the
        `application/did+json` representation by removing the `@context` representation-specific entry during
        consumption.
      </p>

      <p class="advisement">
        Representation-foreign entries in DID documents should be avoided, since the implications on lossless conversion
        between representations is unclear.
      </p>

    </section>
    <p class="note">
      See [[DID-CORE]] for normative requirements associated with the
      <a href="https://www.w3.org/TR/did-core/#data-model">Data Model</a>.
    </p>

    <p class="note">
      See [[DID-CORE]] for normative requirements associated with
      <a href="https://www.w3.org/TR/did-core/#representations">Representations</a>.
    </p>

    <p>
      The DID document data model contains “properties” (such as `id`, `verificationMethod`, and `service`), which are
      defined in a way that is independent of a concrete representation. There are a number of known representations,
      including JSON and JSON-LD (defined by DID Core), and CBOR (defined by a DID WG Note). Additional representations
      (such as XML, YAML, CBOR-LD, and others) are possible and may be defined in the future. For each of these
      representations, a combination of production and consumption rules defines the concrete syntax of properties, but
      the semantics of properties are independent of any given representation. In other words, in every representation
      of a DID document, there is always a way to represent a `service` or a `verificationMethod`, and their meanings
      are consistent across conformant representations.
    </p>

    <p>
      In addition to “properties”, a DID document may contain “representation-specific entries” which may be
      required by certain representations in order to fully represent the DID document data model and its
      properties. For example, the JSON-LD representation of a DID document (with media type `application/did+ld+json`) requires the
      `@context` representation-specific entry, in order to correctly express the semantics of properties such as `id`,
      `verificationMethod` or `service` within the JSON-LD representation. This enables JSON-LD’s semantics which are
      based on a decentralized, permissionless, open-world data model.
    </p>

    <p>
      In contrast to this, the (non-LD) JSON representation (with media type `application/did+json`) does not have this semantic
      capability; instead, (non-LD) JSON documents always need agreement on semantics in some out-of-band way that is
      not part of the document itself. In the case of DID documents using the (non-LD) JSON representation, those semantics are
      typically established by the <a href="https://w3c.github.io/did-spec-registries/">DID Spec Registries</a>. Therefore,
      establishing semantics of DID document properties in the (non-LD) JSON representation does not require
      the representation-specific `@context` entry, as is required by the JSON-LD representation.
    </p>

    <p>
      Similar holds true for the (non-LD) CBOR representation.
    </p>

    <p>
      Other examples of “representation-specific entries” could be XML namespace definitions or YAML tags, although
      these particular representations have not been defined at the time of this writing.
    </p>

    <p>
      If an entry that is specific to one representation appears in another representation, it can be called a
      "representation-foreign entry". An example of this is an `@context` entry appearing in the `application/did+json`
      representation.
    </p>

    <p>
      Examples of “representation-specific entries” and “representation-foreign entries”:
    </p>

    <figure id="representation-entries">
      <img style="margin: auto; display: block;"
           src="diagrams/representation-specific-and-foreign-entries.png" alt="
Examples of representation-specific and representation-foreign entries in various representations.">
      <figcaption>
        Representation-specific and representation-foreign entries.
      </figcaption>
    </figure>

    <section class="informative">
      <h3>
        Avoid representation-foreign entries
      </h3>

      <p class="advisement">
        It is bad practice and potentially harmful for producers to include "representation-foreign entries" in DID
        documents.
      </p>

      <p>
        Different implementations of DID document consumers may or may not be able to properly understand the meaning
        and processing rules of representation-foreign entries. Since DIDs and DID documents form an open ecosystem with
        many producers and consumers, a producer cannot anticipate the behavior of a consumer with regard to
        representation-foreign entries.
      </p>

      <p>
        For example, if a producer adds an `@context` entry to a DID document in the `application/did+json`
        representation, some consumers (those that understand JSON-LD, such as JSON-LD document loaders) may process it
        in one way, while other consumers (those that only understand plain JSON, without any JSON-LD specific rules)
        may process it in a different way.
      </p>

      <p>
        This can lead to inconsistent behavior by consumers that cannot be predicted by a producer.
      </p>

    </section>

    <section class="informative">
      <h3>
        Reliance on representation-foreign entries
      </h3>

      <p class="advisement">
        It is bad practice and potentially harmful for consumers to rely on "representation-foreign entries" in DID
        documents.
      </p>

      <p>
        As a special case of the previous section, certain consumers may go as far as relying on the presence of
        representation-foreign entries. For example, an incorrectly implemented consumer of DID documents in the
        `application/did+json` representation may attempt to apply JSON-LD tooling to that representation. That tooling
        is dependent on the presence of the `@context` representation-foreign entry, which is not actually required (and
        in fact discouraged) to be used in the `application/did+json` representation.
      </p>

      <p>
        The result is lack of interoperability, since such consumers will throw errors even if the returned DID document
        representation is actually conformant.
      </p>

    </section>

    <section class="informative">
      <h3>
        Security problems with representation-foreign entries
      </h3>

      <p>
        If some implementations of DID document consumers process representation-foreign entries, and others don’t, then
        this can lead to security holes, since the semantics of DID document properties will not be interpreted in a
        predictable way.
      </p>

      <p>
        For example, consider the following DID document, and assume that the JSON-LD context
        `https://myextensions.com/other-definitions.jsonld` defines `blockchainAccountId` in a way that is different
        from the <a href="https://w3c.github.io/did-spec-registries/#blockchainaccountid">property listed in the DID
        Specification Registries</a>.
      </p>

      <pre class="example nohighlight" title="A DID document in the `application/did+json` representation with the `@context` representation-foreign entry">
{
  "@context":[
    "https://www.w3.org/ns/did/v1",
    "https://myextensions.com/other-definitions.jsonld"
  ],
  "id":"did:example:123456789abcdefghi",
  "verificationMethod":[{
    "id": "did:example:123456789abcdefghi#vm-3",
    "controller": "did:example:123456789abcdefghi",
    "type": "EcdsaSecp256k1RecoveryMethod2020",
    "blockchainAccountId": "0xF3beAC30C498D9E26865F34fCAa57dBB935b0D74"
  }]
}
      </pre>

      <p>
        If this DID document is consumed as `application/did+json` by an implementation that doesn't understand JSON-LD,
        it will interpret `blockchainAccountId` as the <a
              href="https://w3c.github.io/did-spec-registries/#blockchainaccountid">property listed in the DID
        Specification Registries</a>, and it will process it accordingly.
      </p>

      <p>
        If the exact same DID document is consumed as `application/did+json` by an implementation that understands
        JSON-LD, it may interpret `blockchainAccountId` using the provided JSON-LD context, and therefore process it
        differently.
      </p>

      <p>
        It is a common mistake to claim that "JSON-LD is just JSON", and to justify injecting the `@context`
        representation-foreign entry into a DID document in the `application/did+json` representation. This claim
        however is true only on the syntax level, but wrong and dangerous on the semantic level, especially when
        security-related properties are involved. In the example above, different consumer implementations are likely to
        come to different conclusions on how the DID can be controlled.
      </p>

      <p class="advisement">
        Representation-foreign entries in DID documents should be avoided, since they can lead to inconsistent and
        unpredictable DID control decisions.
      </p>

    </section>

    <section class="informative">
      <h3>
        Conversion between Representations
      </h3>

      <p>
        The DID document data model and the production/consumption rules of representations have been designed to enable
        lossless conversion between representations. Conversion between representations is achieved by executing the
        consumption rules of the source representation, and then the production rules of the target representation.
      </p>

      <p>
        The <a href="https://w3c.github.io/did-spec-registries/">DID Specification Registries</a> provide additional
        information about properties as well as representation-specific entries that help with such conversion. For
        example, a DID document in the `application/did+json` representation can be converted to the
        `application/did+ld+json` representation by adding a `@context` representation-specific entry during production,
        using the JSON-LD context information in the DID <a href="https://w3c.github.io/did-spec-registries/">Specification
        Registries</a>.
      </p>

      <p>
        Conversely, a DID document in the `application/did+ld+json` representation can be converted to the
        `application/did+json` representation by removing the `@context` representation-specific entry during
        consumption.
      </p>

      <p class="advisement">
        Representation-foreign entries in DID documents should be avoided, since the implications on lossless conversion
        between representations is unclear.
      </p>

    </section>
    </section>

    <section>
      <h2>Approach 2</h2>
      
      <p>
        Implementers are not required to support all representations. 
        For example, an implementation might choose to only support <code>application/did+json</code>, 
        and choose not to support <code>application/did+ld+json</code>, <code>application/did+dag+cbor</code>,
         <code>application/did+xml</code>, <code>application/did+yaml</code>, etc...
      </p>

      <p>
        Implementers might prefer to use JSON or YAML representations to implement both the 
         abstract data model and concrete reprepresentations.
      </p>

      <p>
        When converting between an implementation of the abstract data model and a
        representation that is capable of preserving all properties, 
        all properties SHOULD be preserved.
      </p>

      <p>For example, preserving <code>@context</code> in YAML, 
        allows for the document to later be used with 
        <a href="https://www.w3.org/TR/json-ld11-api/#loaddocumentcallback">documentLoaders</a> that use 
        <a href="https://www.w3.org/TR/json-ld11-framing/">frame</a> to perform dereferencing.
      </p>  

      <pre class="example">
---
"@context":
- https://www.w3.org/ns/did/v1
- https://w3id.org/security/suites/jws-2020/v1
id: did:key:z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6
verificationMethod:
- id: did:key:z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6#z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6
  type: JsonWebKey2020
  controller: did:key:z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6
  publicKeyJwk:
    kty: EC
    crv: P-384
    x: ELYfgFzSi43VGgKlyuYBKeoW00DmNqf5VuMWD1iUTTHQ8NRQrR4KHShzH_DrvOhh
    y: sftqdHdso4JPQO3MLnsXmWbAFqjmHLgP8H_DZSLxx3ei9kLj_W3R6NhtH03bwE1C
assertionMethod:
- did:key:z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6#z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6
authentication:
- did:key:z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6#z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6
capabilityInvocation:
- did:key:z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6#z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6
capabilityDelegation:
- did:key:z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6#z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6
keyAgreement:
- did:key:z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6#z82Lkm8gN2PGD7WbUiTUKRHgSptPhGPAQG9HT9HybYE9LoKYwcikh5rAU9gGo3qTne3ZHf6

      </pre>

      <p class="note">Preserving members across representations is also common in 
        <a href="https://swagger.io/specification/">OpenAPI Specification 3.0.3</a>,
      which supports 
      <a href="https://datatracker.ietf.org/doc/html/draft-wright-json-schema-00#section-4.2">JSON Schema</a>
      represented as YAML or JSON.
      </p>

      <p>DID Methods that support both <code>application/did+ld+json</code> and <code>application/did+json</code> 
        SHOULD return <code>application/did+json</code> with an <code>@context</code>, because it enables
        both representations to be used with tooling and standards that support semantics (such as [[VC-DATA-MODEL]]), 
        and because the default behavior of JSON processors is to ignore object members that are not understood.
      </p>

      <p>DID Document representations produced by an implementation SHOULD be treated as immutable, 
        and any tampering, including addind, removing, or reordering core or representation specific properties
        SHOULD be treated as malicious, since it alters the integrity of the produced DID Document.</p>

    </section>  
  </section>

  <section class="informative">
    <h2>Privacy Considerations</h2>

    <p>
      Decentralized Identifiers, like any other technology, can be used to
      enhance privacy as well as harm privacy. This section speaks to topics
      that implementers might consider when thinking about the privacy
      characteristics of their software systems.
    </p>

    <section class="informative">
      <h3>
        Dealing with Personal Data
      </h3>

      <p class="advisement">
        Never store personal data, even in an encrypted format, on any verifiable data
        registry backed by immutable storage.
      </p>

      <p>
        It is the DID method implementer's responsibility to think about and identify
        the extent to which personal data may be included in a DID document.
      </p>

      <p>
        Software should at least display a warning and ask for confirmation before creating
        or updating any properties of a DID document that depend on user provided inputs.
      </p>

      <p>
        A DID method specification should have a section dedicated to personal data covering the extent to
        which information published on the corresponding ledger can be updated or deleted.
        It should provide specific instructions of how to do so, if it is possible.
        Otherwise, it should clearly state that it is not possible.
      </p>
    </section>

    <section class="informative">
      <h3>Avoid correlation</h3>

      <p class="advisement">
        Avoid reusing verification methods across DID Methods.
      </p>

      <p class="advisement">
        Avoid reusing services with unique parameters across DID Methods.
      </p>

      <p>
        Any anonymous identifier, even if it is generated randomly, can be used to
        infer sensitive information about a <a href="#dfn-did-subjects">DID subject</a> 
        if it is reused enough times.
      </p>

      <p>
        A DID method implementer should rotate keys and identifiers as often as possible
        to avoid correlation
      </p>
    </section>

    <section class="informative">
      <h3>Anonymity</h3>

      <p>
        Consider formally modeling the privacy implications associated with
        your implementation using
        <a href="https://en.wikipedia.org/wiki/T-closeness">t-closeness</a> or
        other mechanisms.
      </p>

      <p>
        If your DID Method supports global enumeration and indexing, consider
        exposing this information publicly. You may wish to provide alerts
        similar to services that watch version control systems for sensitive
        information that is accidentally leaked.
      </p>
    </section>

    <section class="informative">
      <h3>Compliance</h3>

      <p>
        Review any applicable local law when considering developing or
        operating a decentralized identifier method.
      </p>

      <p>Consider <a href="https://gdpr.eu/">GDPR.</a></p>

      <p>Consider <a href="https://oag.ca.gov/privacy/ccpa">CCPA.</a></p>
    </section>
  </section>

  <section class="informative">
    <h2>Security Considerations</h2>

    <p>
      Decentralized Identifiers are security primitives that are often used to
      secure important systems. This section speaks to topics that
      implementers might consider when thinking about the security
      characteristics of their software systems.
    </p>

    <p>
      Consider in depth the defense, cryptographic agility, and political
      acceptability of any cryptography you rely on for DID Method security.
    </p>

    <p>
      Avoid complex or slow signature formats, especially if they are poorly
      documented, or do not have an open standard with well documented test
      vectors.
    </p>

    <p class="advisement">
      Avoid open source implementations that are declared a "defacto
      standard", but lack open standard technical specification.
    </p>

    <p class="advisement">
      Add support for legacy cryptography systems such as
      <a href="https://www.iana.org/assignments/jose/jose.xhtml">JOSE</a>
      and <a href="https://www.openpgp.org/">OpenPGP</a>.
    </p>

    <section class="informative">
      <h3>Vendor Lock</h3>
      <p>
        Competition, direct substitutability, interoperability, and mutual
        feature support are key to reducing the barriers to adoption of, and
        increasing confidence in, your DID Method.
      </p>

      <p>
        Avoid inventing "new features". Work with others to find a common way
        to express any new features that are not unique to your DID Method.
      </p>

      <p>
        Avoid hard coupling to specific networks, such as Bitcoin or
        Hyperledger Fabric. Design your method such that it may be adapted
        to support multiple ledger systems.
      </p>
    </section>

    <section class="informative">
      <h3>Digital Signatures</h3>

      <p class="advisement">
        Review
        <a href="https://safecurves.cr.yp.to/">safecurves.cr.yp.to</a> before
        selecting elliptic curve types.
      </p>

      <p class="advisement">Avoid secp256k1, RSA, P-256, P-384, P-521.</p>

      <p>
        Avoid relying on smart contracts for complex data management. If you
        must use a smart contract, keep it simple and architect a solution
        that supports data migration.
      </p>
    </section>

    <section class="informative">
      <h3>Hashing Algorithms</h3>

      <p>Avoid MD5.</p>
    </section>

    <section class="informative">
      <h3>Zero Knowledge Proofs</h3>

      <p>
        Consider using
        <a href="https://w3c-ccg.github.io/ldp-bbs2020/">BBS+ Signatures</a>
        for selective disclosure and linked-secret&ndash;based JSON-LD verifiable
        credentials.
      </p>

      <p>
        Avoid zero knowledge proofs as described in the
        <a
          href="https://w3c.github.io/vc-data-model/#example-25-a-verifiable-presentation-that-supports-cl-signatures">AnonCredDerivedCredentialv1</a>.
        This proof format is coupled to specific ledger technologies,
        similar to the concept of an ethereum virtual machine smart contract
        only running on EVM compatible ledgers. Ledger-specific technologies
        should be avoided when designing for portable, interoperable, and 
        open-standards&ndash;based zero knowledge proofs.
      </p>

      <p>
        Avoid storing credential schemas on ledgers. Many DID methods cannot
        store information other than a DID Document, which reduces the direct
        interoperability, substitutability, and cost effectiveness of
        solutions that make use of rare or poorly supported features such as
        credential schema definition storage.
      </p>
    </section>

    <section class="informative">
      <h3>Biometrics</h3>

      <p>Avoid relying exclusively on biometrics.</p>

      <p>
        Hardware-isolated keys protected by biometrics on devices may increase
        the usability of DIDs.
      </p>
    </section>
  </section>

  <section>
    <h2>Future Work</h2>
    <p class="note">
      This section was copied from
      <a href="https://github.com/w3c/did-imp-guide/">w3c/did-imp-guide</a>, and adjusted based on changes made to DID
      Core.
    </p>

    <section>
      <h2>Upper Limits on DID Character Length</h2>

      <p>
        The current specification does not take a position on the maximum length
        of a
        <a>DID</a>. The maximum interoperable URL length is currently about
        2048 characters. QR codes can handle about 4096 characters. Clients
        using <a>DIDs</a> will be responsible for storing many <a>DIDs</a>,
        and some methods would be able to externalize some of their costs
        onto clients by relying on more complicated signature schemes or by
        adding state into <a>DIDs</a> intended for temporary use. A future
        version of this specification should set reasonable limits on
        <a>DID</a> character length to minimize externalities.
      </p>
    </section>
    <section>
      <h2>Verifiable Timestamps</h2>

      <p>
        <a>Verifiable timestamps</a> have significant utility for identifier
        records. This is a good fit for <a>DLTs</a>, since most offer some
        type of timestamp mechanism. Despite some transactional cost, they
        are the among the most censorship-resistant transaction ordering
        systems at the present, so they are nearly ideal for
        <a>DID document</a> timestamping. In some cases a <a>DLT</a>'s
        immediate timing is approximate, however their sense of
        <a href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki%23Abstract">
          "median time past" (see Bitcoin BIP 113)</a>
        can be precisely defined. A generic <a>DID document</a> timestamping
        mechanism could would work across all <a>DLTs</a> and might operate
        via a mechanism including either individual transactions or
        transaction batches. Such a generic mechanism was deemed out of scope
        for this version, although it may be included in a future version of
        this specification.
      </p>
    </section>

    <section>
      <h2>Verifiable Credentials</h2>

      <p>
        Although <a>DIDs</a> and <a>DID documents</a> form a foundation for
        decentralized identity, they are only the first step in describing
        their subjects. The rest of the descriptive power comes through
        collecting and selectively using Verifiable Credentials
        [[VC-DATA-MODEL]]. Future versions of the specification will
        describe in more detail how <a>DIDs</a> and <a>DID document</a> can
        be integrated with &mdash; and help enable &mdash; the Verifiable
        Credentials ecosystem.
      </p>
    </section>

    <section>
      <h2>Alternate Serializations and Graph Models</h2>

      <p>
        This version of the specification relies on JSON-LD and the RDF
        graph model for expressing a <a>DID document</a>. Future versions of
        this specification might specify other semantic graph formats for a
        <a>DID document</a>.
      </p>
    </section>
  </section>
  </section>
</body>

</html>
